<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–¢–æ–ª—å–∫–æ –ú—ã: –ü–æ–ª–Ω–∞—è –ò–Ω—Ç—Ä–∏–≥–∞</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary: #FF8E9E;
            --primary-dark: #FF6B81;
            --loud: #6c5ce7;
            --match: #00cec9;
            --action: #f1c40f;
            --success: #2ecc71;
            --text: #2d3436;
            --glass: rgba(255, 255, 255, 0.85);
            --shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { font-family: 'Quicksand', sans-serif; height: 100dvh; overflow: hidden; background-color: #fff0f3; }

        .bg-blobs { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; overflow: hidden; }
        .blob { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.6; animation: float 20s infinite alternate; }
        .blob-1 { width: 350px; height: 350px; background: #a29bfe; top: -50px; left: -50px; }
        .blob-2 { width: 450px; height: 450px; background: #ff7675; bottom: -100px; right: -50px; }
        .blob-3 { width: 300px; height: 300px; background: #81ecec; top: 40%; left: 30%; }
        @keyframes float { 0% { transform: translate(0, 0); } 100% { transform: translate(40px, 60px); } }

        #app { width: 100%; height: 100%; display: flex; flex-direction: column; padding: env(safe-area-inset-top) 20px env(safe-area-inset-bottom); }

        /* HEADER */
        .header { position: absolute; top: calc(15px + env(safe-area-inset-top)); left: 15px; right: 15px; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        .player-score { background: var(--glass); padding: 8px 15px; border-radius: 20px; backdrop-filter: blur(10px); text-align: center; min-width: 90px; transition: 0.3s; }
        .player-score b { font-size: 1.2rem; color: var(--primary-dark); }
        .active-turn { border: 2px solid var(--primary); transform: scale(1.05); box-shadow: 0 5px 15px rgba(255,142,158,0.2); }
        .player-score:not(.active-turn) { opacity: 0.5; }
        .harmony-heart { font-size: 2rem; animation: heartPulse 2s infinite; }
        @keyframes heartPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* ROLES INDICATOR */
        .roles-bar { margin-top: 75px; display: flex; flex-direction: column; align-items: center; gap: 5px; }
        .role-title { font-size: 0.7rem; font-weight: 800; color: #95a5a6; text-transform: uppercase; letter-spacing: 1px; }
        .role-names { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1rem; }
        .role-asking { color: var(--primary-dark); }
        .role-answering { color: var(--text); opacity: 0.7; }

        /* CARD */
        .card-stack { width: 100%; flex-grow: 1; display: flex; align-items: center; justify-content: center; perspective: 1000px; padding: 20px 0; }
        .card {
            background: var(--glass); width: 100%; max-width: 340px; min-height: 400px;
            border-radius: 35px; padding: 35px; box-shadow: var(--shadow);
            border: 1px solid rgba(255,255,255,0.6); display: flex; flex-direction: column;
            justify-content: center; align-items: center; position: relative;
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); backdrop-filter: blur(15px);
        }
        .card.loud-mode { border: 4px solid var(--loud); }
        .card.match-mode { border: 4px solid var(--match); }
        .card.action-mode { border: 4px dashed var(--action); }

        .card-text { font-size: 1.5rem; font-weight: 700; line-height: 1.4; text-align: center; transition: 0.4s ease; }
        .blurred { filter: blur(25px); opacity: 0.1; transform: scale(0.95); }
        
        .stage-badge { position: absolute; top: -15px; background: var(--text); color: white; padding: 6px 15px; border-radius: 20px; font-size: 0.7rem; font-weight: 800; }
        .tap-hint { font-size: 0.8rem; color: var(--primary-dark); margin-top: 20px; font-weight: 800; display: flex; align-items: center; gap: 5px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(5px); } }

        /* INPUT AREA */
        .input-area { width: 100%; margin-top: 20px; display: none; flex-direction: column; gap: 10px; }
        .match-input { width: 100%; padding: 15px; border-radius: 15px; border: 2px solid #ddd; font-family: inherit; font-size: 1rem; text-align: center; outline: none; -webkit-user-select: text; user-select: text; }
        .match-input:focus { border-color: var(--match); }

        /* BUTTONS */
        .btn { padding: 18px; border-radius: 22px; border: none; font-size: 1rem; font-weight: 700; cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-start { background: linear-gradient(135deg, var(--primary), var(--primary-dark)); color: white; width: 100%; max-width: 280px; }
        .btn-yes { background: var(--success); color: white; flex: 1; box-shadow: 0 5px 15px rgba(46, 204, 113, 0.3); }
        .btn-no { background: white; color: #95a5a6; flex: 1; }
        .btn-action { background: var(--match); color: white; width: 100%; }

        .timer-bar { width: 100%; height: 6px; background: rgba(0,0,0,0.05); border-radius: 10px; margin-bottom: 20px; overflow: hidden; }
        .timer-fill { height: 100%; background: var(--primary); width: 100%; transition: width 1s linear; }

        .screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: 0.4s ease; padding: 20px; }
        .screen.active { opacity: 1; pointer-events: all; }
    </style>
</head>
<body>

    <div class="bg-blobs">
        <div class="blob blob-1"></div><div class="blob blob-2"></div><div class="blob blob-3"></div>
    </div>

    <div id="app">
        <div class="header" id="game-header" style="opacity: 0;">
            <div class="player-score" id="score-0"><small id="name-0"></small> <b id="val-0">0</b></div>
            <div class="harmony-heart" id="harmony-heart">‚ù§Ô∏è</div>
            <div class="player-score" id="score-1"><small id="name-1"></small> <b id="val-1">0</b></div>
        </div>

        <div id="screen-start" class="screen active">
            <h1 style="font-family: 'Pacifico'; color: var(--primary-dark); font-size: 3rem; margin-bottom: 10px;">–¢–æ–ª—å–∫–æ –ú—ã</h1>
            <p style="margin-bottom: 40px; color: #636e72;">–ê–±—Å–æ–ª—é—Ç–Ω–∞—è —Å–µ–∫—Ä–µ—Ç–Ω–æ—Å—Ç—å</p>
            <button class="btn btn-start" onclick="initGame('–í–∞–Ω—è')" style="margin-bottom: 10px;">–ù–∞—á–∏–Ω–∞–µ—Ç –í–∞–Ω—è üíô</button>
            <button class="btn btn-start" style="background: #a29bfe;" onclick="initGame('–î–∞—à–∞')">–ù–∞—á–∏–Ω–∞–µ—Ç –î–∞—à–∞ üíñ</button>
        </div>

        <div id="screen-game" class="screen">
            <div class="roles-bar">
                <div class="role-title">–°–µ–π—á–∞—Å —Ö–æ–¥</div>
                <div class="role-names">
                    <span class="role-asking" id="role-asking">---</span>
                    <span style="color: #ccc; font-size: 0.8rem;">‚ûî</span>
                    <span class="role-answering" id="role-answering">---</span>
                </div>
            </div>

            <div class="card-stack">
                <div class="card" id="main-card" onclick="revealCard()">
                    <div class="stage-badge" id="stage-label">–≠—Ç–∞–ø</div>
                    <div id="card-instr" style="font-size: 0.8rem; font-weight: 800; margin-bottom: 15px; color: #95a5a6;"></div>
                    
                    <div class="card-text blurred" id="card-text">–¢—É—Ç —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å...</div>
                    
                    <div id="tap-hint" class="tap-hint">
                        <span>üëÜ</span> –ù–∞–∂–º–∏, —á—Ç–æ–±—ã –ø—Ä–æ—á–∏—Ç–∞—Ç—å
                    </div>

                    <div class="input-area" id="match-input-area">
                        <input type="text" class="match-input" id="match-val" placeholder="–¢–≤–æ–π —Ç–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç..." autocomplete="off">
                        <button class="btn btn-action" onclick="saveMatchAnswer()">–ì–æ—Ç–æ–≤–æ! –ü–µ—Ä–µ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω</button>
                    </div>
                    <div id="revealed-secret" style="color: var(--match); font-weight: 800; margin-top: 20px; display: none; text-align: center;"></div>
                </div>
            </div>

            <div style="width: 100%; padding-bottom: 20px;">
                <div class="timer-bar"><div class="timer-fill" id="timer-fill"></div></div>
                
                <div id="game-btns" style="display: none; gap: 15px;">
                    <button class="btn btn-no" onclick="handleAnswer(false)">ü§î –ü—Ä–æ–ø—É—Å–∫</button>
                    <button class="btn btn-yes" onclick="handleAnswer(true)">üòç –°—É–ø–µ—Ä! +1</button>
                </div>
                
                <button id="show-match-btn" class="btn btn-action" style="display: none;" onclick="showMatchAnswer()">üëÄ –ü–æ–∫–∞–∑–∞—Ç—å —Ç–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç</button>
            </div>
        </div>

        <div id="screen-end" class="screen">
            <h1 style="font-family: 'Pacifico'; color: var(--primary-dark);">–í—ã ‚Äî –ö–æ—Å–º–æ—Å!</h1>
            <div class="card" style="min-height: 200px; margin: 25px 0;">
                <p style="margin-bottom: 10px;">–í–∞—à —É—Ä–æ–≤–µ–Ω—å —Å–≤—è–∑–∏:</p>
                <h1 id="total-score" style="font-size: 4rem; color: var(--success);">0</h1>
            </div>
            <button class="btn btn-start" onclick="location.reload()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </div>

    <script>
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSfx(f, d, t='sine') {
            const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
            o.type = t; o.frequency.value = f; g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + d);
            o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime + d);
        }

        const data = {
            stages: [
                { name: "üíï –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ", questions: [
                    { t: "–¢–≤–æ—ë —Å–∞–º–æ–µ –ø–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –æ–±–æ –º–Ω–µ?", loud: false },
                    { t: "–ö–∞–∫–∞—è –ø–µ—Å–Ω—è —É —Ç–µ–±—è –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å–æ –º–Ω–æ–π?", loud: true },
                    { t: "–í –∫–∞–∫–æ–π –æ–¥–µ–∂–¥–µ —è —Ç–µ–±–µ –Ω—Ä–∞–≤–ª—é—Å—å –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?", match: true },
                    { t: "–î–ï–ô–°–¢–í–ò–ï: –ì–ª—è–¥—è –≤ –≥–ª–∞–∑–∞, —Å–∫–∞–∂–∏—Ç–µ –ø–æ –æ–¥–Ω–æ–º—É —Å–∞–º–æ–º—É —á–µ—Å—Ç–Ω–æ–º—É –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—É.", action: true }
                ]},
                { name: "üî• –°–±–ª–∏–∂–µ–Ω–∏–µ", questions: [
                    { t: "–ß—Ç–æ –≤–æ –º–Ω–µ —Ç–µ–±—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ —É–º–∏–ª—è–µ—Ç?", loud: false },
                    { t: "–ú–æ—ë –ª—é–±–∏–º–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞?", match: true },
                    { t: "–ö–∞–∫–æ–µ –Ω–∞—à–µ –æ–±—â–µ–µ –≤–æ—Å–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–∞–º–æ–µ —è—Ä–∫–æ–µ –¥–ª—è —Ç–µ–±—è?", loud: true },
                    { t: "–î–ï–ô–°–¢–í–ò–ï: –û–±–Ω–∏–º–∏—Ç–µ—Å—å —Ç–∞–∫ –∫—Ä–µ–ø–∫–æ, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –º–æ–∂–µ—Ç–µ, –Ω–∞ 20 —Å–µ–∫—É–Ω–¥.", action: true }
                ]},
                { name: "‚ú® –ï–¥–∏–Ω—Å—Ç–≤–æ", questions: [
                    { t: "–ï—Å–ª–∏ –±—ã –º—ã –º–æ–≥–ª–∏ —É–ª–µ—Ç–µ—Ç—å –∫—É–¥–∞ —É–≥–æ–¥–Ω–æ –∑–∞–≤—Ç—Ä–∞, –∫—É–¥–∞ –±—ã –º—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏—Å—å?", match: true },
                    { t: "–ß—Ç–æ —Ç—ã —Å—á–∏—Ç–∞–µ—à—å –Ω–∞—à–µ–π –≥–ª–∞–≤–Ω–æ–π —Å–µ–º–µ–π–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç—å—é?", loud: true },
                    { t: "–§–∏–Ω–∞–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ: –ü–æ—Ü–µ–ª—É–π –≤ –≥—É–±—ã –Ω–∞ 10 —Å–µ–∫—É–Ω–¥! ‚ù§Ô∏è", action: true }
                ]}
            ]
        };

        let state = {
            p: [{n:"", s:0}, {n:"", s:0}],
            turn: 0, stageIdx: 0, qIdx: 0, deck: [], totalH: 0, secretMatch: "", isRevealed: false
        };

        function initGame(name) {
            state.p[0].n = name; state.p[1].n = (name==="–í–∞–Ω—è"?"–î–∞—à–∞":"–í–∞–Ω—è");
            document.getElementById('name-0').innerText = state.p[0].n;
            document.getElementById('name-1').innerText = state.p[1].n;
            document.getElementById('game-header').style.opacity = 1;
            changeScreen('screen-start', 'screen-game');
            loadStage();
        }

        function loadStage() {
            state.deck = [...data.stages[state.stageIdx].questions].sort(()=>Math.random()-0.5);
            state.qIdx = 0; renderCard();
        }

        function renderCard() {
            if(state.qIdx >= state.deck.length) {
                state.stageIdx++;
                if(state.stageIdx >= data.stages.length) return endGame();
                return loadStage();
            }

            const q = state.deck[state.qIdx];
            const card = document.getElementById('main-card');
            const txt = document.getElementById('card-text');
            const instr = document.getElementById('card-instr');
            
            state.isRevealed = false;
            card.style.transform = "translateX(-150%) rotate(-10deg)"; 
            card.style.opacity = "0";

            setTimeout(() => {
                txt.innerText = q.t;
                txt.className = "card-text blurred"; 
                document.getElementById('tap-hint').style.display = "flex";
                document.getElementById('stage-label').innerText = data.stages[state.stageIdx].name;
                
                card.className = "card";
                instr.innerText = "–í–û–ü–†–û–° –î–õ–Ø –ó–ê–î–ê–Æ–©–ï–ì–û";
                document.getElementById('match-input-area').style.display = "none";
                document.getElementById('revealed-secret').style.display = "none";
                document.getElementById('game-btns').style.display = "none";
                document.getElementById('show-match-btn').style.display = "none";

                if(q.loud) { card.classList.add('loud-mode'); instr.innerText = "üéß –ì–†–û–ú–ö–ò–ô –í–û–ü–†–û–°"; }
                else if(q.match) { card.classList.add('match-mode'); instr.innerText = "ü§ù –°–û–í–ü–ê–î–ï–ù–ò–ï"; }
                else if(q.action) { card.classList.add('action-mode'); instr.innerText = "‚ö° –î–ï–ô–°–¢–í–ò–ï"; }

                card.style.transform = "translateX(0) rotate(0deg)"; 
                card.style.opacity = "1";
                updateUI();
                startTimer();
            }, 400);
        }

        function revealCard() {
            if(state.isRevealed) return;
            const q = state.deck[state.qIdx];
            const txt = document.getElementById('card-text');

            state.isRevealed = true;
            txt.classList.remove('blurred');
            document.getElementById('tap-hint').style.display = "none";
            playSfx(600, 0.1);

            if(q.match) {
                document.getElementById('match-input-area').style.display = "flex";
            } else {
                document.getElementById('game-btns').style.display = "flex";
            }
        }

        function saveMatchAnswer() {
            const val = document.getElementById('match-val').value;
            if(!val) return;
            state.secretMatch = val;
            document.getElementById('match-input-area').style.display = "none";
            document.getElementById('card-text').innerText = "–í–æ–ø—Ä–æ—Å –∑–∞–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –ø—É—Å—Ç—å –æ—Ç–≤–µ—á–∞–µ—Ç " + state.p[state.turn===0?1:0].n;
            document.getElementById('show-match-btn').style.display = "flex";
            document.getElementById('match-val').value = "";
            playSfx(800, 0.2, 'triangle');
        }

        function showMatchAnswer() {
            document.getElementById('revealed-secret').innerText = "–¢–∞–π–Ω—ã–π –æ—Ç–≤–µ—Ç –±—ã–ª: " + state.secretMatch;
            document.getElementById('revealed-secret').style.display = "block";
            document.getElementById('show-match-btn').style.display = "none";
            document.getElementById('game-btns').style.display = "flex";
            playSfx(1000, 0.2);
        }

        function handleAnswer(good) {
            if(good) {
                state.p[state.turn].s++;
                state.totalH++;
                document.getElementById(`val-${state.turn}`).innerText = state.p[state.turn].s;
                
                const heart = document.getElementById('harmony-heart');
                heart.style.transform = `scale(${1 + state.totalH*0.05})`;
                
                confetti({ particleCount: 40, spread: 50, origin: { y: 0.8 }, colors: ['#FF8E9E', '#00cec9'] });
                playSfx(1200, 0.3, 'triangle');
            }
            state.qIdx++;
            state.turn = (state.turn === 0 ? 1 : 0);
            renderCard();
        }

        function updateUI() {
            document.getElementById('role-asking').innerText = state.p[state.turn].n;
            document.getElementById('role-answering').innerText = state.p[state.turn===0?1:0].n;
            document.getElementById('score-0').classList.toggle('active-turn', state.turn===0);
            document.getElementById('score-1').classList.toggle('active-turn', state.turn===1);
        }

        function startTimer() {
            clearInterval(state.timerInt);
            let time = 60;
            const fill = document.getElementById('timer-fill');
            state.timerInt = setInterval(() => {
                time--; fill.style.width = (time/60*100)+"%";
                if(time<=0) clearInterval(state.timerInt);
            }, 1000);
        }

        function changeScreen(f, t) {
            document.getElementById(f).classList.remove('active');
            setTimeout(()=>document.getElementById(t).classList.add('active'), 250);
        }

        function endGame() {
            document.getElementById('total-score').innerText = state.totalH;
            document.getElementById('game-header').style.opacity = 0;
            changeScreen('screen-game', 'screen-end');
        }
    </script>
</body>
</html>
